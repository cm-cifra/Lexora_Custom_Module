<odoo>
  <template id="template_product_configuration" name="Product Configuration">
    <t t-call="website.layout">
      <div class="container my-4">

        <!-- Collection Dropdown -->
        <div class="mb-2">
          <label for="collection_select" class="form-label">Select Collection</label>
          <select id="collection_select" class="form-select" name="collection" onchange="location = this.value;">
            <option t-if="not selected_collection" selected="selected" disabled="disabled">Select collection</option>
            <t t-foreach="collections" t-as="col">
              <option t-att-value="'/kits?collection=%s' % col" t-att-selected="col == selected_collection">
                <t t-esc="col"/>
              </option>
            </t>
          </select>
        </div>

        <!-- Color Badges: Only show if collection is selected -->
        <t t-if="selected_collection and colors">
          <div class="mb-2">
            <strong>Colors:</strong>
            <div style="overflow-x: auto; white-space: nowrap;" class="mt-2 pb-1">
              <t t-foreach="colors" t-as="color">
                <a t-att-href="'/kits?collection=%s%s' % (
                selected_collection, '&amp;color=' + color if selected_color != color else ''
              )" t-att-class="'badge rounded-pill me-2 px-3 py-2 mb-2 d-inline-block ' + ('bg-secondary text-white' if color == selected_color else 'bg-light text-dark')" style="cursor:pointer;">
                  <t t-esc="color"/>
                </a>
              </t>
            </div>
          </div>
        </t>


        <!-- Show rest only if collection selected -->
        <t t-if="selected_color">

          <div class="row">
            <!-- LEFT COLUMN: Configured image or cabinet fallback -->
            <div class="col-md-6 mb-2">
              <t t-if="selected_sku and selected_size">
                <!-- Load the cabinet product -->
                <t t-set="cabinet_product" t-value="request.env['product.product'].sudo().search([('default_code', '=', selected_sku)], limit=1)" />

                <!-- Show configured product if a valid combination exists -->
                <t t-if="configured_product">

                  <div class="position-relative out-of-stock-wrapper" onclick="openModal()">
                    <!-- Image -->

                    <div class="d-none d-md-block">
                      <img t-att-src="'data:image/png;base64,%s' % configured_product.image_1920.decode('utf-8')" alt="Configured Product" class="img-thumbnail" style="width: 100%; height: 450px; object-fit: contain;"/>

                    </div>

                    <!-- Mobile view: combo box -->
                    <div class="d-block d-md-none">
                      <img t-att-src="'data:image/png;base64,%s' % configured_product.image_1920.decode('utf-8')" alt="Configured Product" class="img-thumbnail" style="width: 100%; height: 300px; object-fit: contain;"/>

                    </div>






                    <!-- Overlay Message for Out of Stock -->
                    <t t-if="configured_product.qty_available == 0">
                      <div class="out-of-stock-overlay position-absolute top-0 start-0 w-100 h-100 d-flex justify-content-center align-items-center">
                        <div class="overlay-text">
                          Out of Stock
                        </div>
                      </div>
                    </t>
                  </div>
                </t>

                <!-- If no combination, show fallback cabinet image -->
                <!-- <t t-elif="cabinet_product">
                  <img t-att-src="'data:image/png;base64,%s' % cabinet_product.image_1920.decode('utf-8')" alt="Cabinet" class="img-thumbnail" style="width: 100%; height: 500px; object-fit: contain;" />
                  <div class="mt-2 text-center">
                    <strong>Selected components resulted no existing combination</strong>
                    <strong t-esc="cabinet_product.name or 'Cabinet Product'" /><br />
                    <small class="text-muted" t-esc="cabinet_product.default_code or ''" />
                  </div>
                </t> -->

                <t t-elif="cabinet_product">



                  <div class="d-none d-md-block">
                    <div class="border rounded bg-light text-muted d-flex align-items-center justify-content-center" style="width: 100%; height: 500px;">
                      Non-existing SKU.
                    </div>
                  </div>

                  <!-- Mobile view: combo box -->
                  <div class="d-block d-md-none">
                    <div class="border rounded bg-light text-muted d-flex align-items-center justify-content-center" style="width: 100%; height: 300px;">
                      Non-existing SKU.
                    </div>
                  </div>

                </t>




                <!-- If no image available -->
                <t t-else="">
                  <div class="border rounded bg-light text-muted d-flex align-items-center justify-content-center" style="width: 100%; height: 500px;">
                    No image available
                  </div>
                </t>
              </t>

              <!-- If no SKU selected at all -->
              <t t-if="not selected_sku and not selected_size">
                <div class="border rounded bg-light text-muted d-flex align-items-center justify-content-center" style="width: 100%; height: 500px;">
                  No cabinet selected
                </div>
              </t>

              <!-- Modal -->
              <t t-if="configured_product">
                <div class="modal" id="imageModal" tabindex="-1" aria-labelledby="imageModalLabel" aria-hidden="true" style="display: none;" onclick="closeModal()">
                  <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                      <div class="modal-body">
                        <!-- Image to be dynamically updated -->
                        <img id="modalImage" t-att-src="'data:image/png;base64,%s' % configured_product.image_1920.decode('utf-8')" alt="Product Image" style="width: 100%; height: auto; object-fit: contain;" />
                      </div>
                    </div>
                  </div>
                </div>
              </t>


            </div>

            <!-- RIGHT COLUMN: Size cards -->
            <div class="col-md-6">

              <t t-if="configured_product">
                <div class="text-left">
                  <h3 t-esc="configured_product.name or 'Unnamed Product'" />
                  <div class="d-flex align-items-center w-100 text-muted">
                    <small t-esc="configured_product.default_code or ''" />
                    <span class="mx-1">/</span>
                    <small t-esc="selected_collection or ''"/>
                  </div>

                  <div class="d-none d-md-block">

                    <div class="my-1">
                      <t t-if="configured_product.product_tag_ids">
                        <t t-foreach="configured_product.product_tag_ids" t-as="tag">
                          <span class="badge bg-light text-dark me-2 mb-2 px-3 py-2">
                            <t t-esc="tag.name"/>
                          </span>
                        </t>
                      </t>
                      <t t-if="not configured_product.product_tag_ids">
                        <span class="text-muted">No tags available</span>
                      </t>
                    </div>
                  </div>

                  <!-- Mobile view: combo box -->
                  <div class="d-block d-md-none">

                  </div>

                  <!-- <h4 t-esc="configured_product.property_product_pricelist"/> -->
                </div>

                <!-- <h2 t-esc="configured_product.lst_price" class="my-2"/> -->
                <h2 t-esc="fixed_price"/>

                <t t-if="configured_product.qty_available > 0">
                  <div class="product-action-container w-100 d-flex justify-content-center my-3">
                    <form action="/shop/cart/update" method="post" class="d-flex w-100 align-items-center gap-3">

                      <!-- Hidden Inputs -->
                      <input type="hidden" name="product_id" t-att-value="configured_product.id" />
                      <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()" />

                      <!-- Quantity Selector (flex-1) -->
                      <div class="input-group quantity-group flex-grow-1" style="height: 44px;">
                        <button type="button" class="btn btn-outline-secondary" onclick="let input = this.parentNode.querySelector('input'); if (input.value > 1) input.stepDown();">âˆ’</button>
                        <input name="add_qty" type="number" class="form-control text-center" value="1" min="1" />
                        <button type="button" class="btn btn-outline-secondary" onclick="this.parentNode.querySelector('input').stepUp()">+</button>
                      </div>

                      <!-- Add to Cart Button (flex-auto) -->
                      <button type="submit" class="btn btn-dark fw-semibold shadow-sm d-flex align-items-center justify-content-center gap-2 px-4 py-2 flex-shrink-0">
                        <i class="fa fa-cart-plus me-2"></i> Add to Cart
                      </button>

                      <!-- Buy Now Button (flex-auto) -->
                      <button type="button" id="buy_now_button" class="btn btn-outline-primary fw-semibold shadow-sm d-flex align-items-center justify-content-center gap-2 px-4 py-2 flex-shrink-0">
                        <i class="fa fa-bolt me-2"></i> Buy Now
                      </button>

                    </form>
                  </div>

                </t>

                <t t-if="configured_product.qty_available == 0">
                  <div class="d-flex flex-column space-y-2 mb-2">
                    <span class="text-danger my-3 w-auto text-left">No available stock</span>
                    <!-- <button class="btn btn-secondary px-4 py-2" id="buy-now-btn" type="button">
                      Save for Later
                    </button> -->
                    <!-- <a t-att-href="'/shop/wishlist/add/' + str(configured_product.id)" class="btn btn-secondary fw-semibold shadow-sm d-flex align-items-center gap-2 px-4 py-2">
                        <i class="fa fa-heart"></i> Save for Later
                    </a> -->
                    <!-- <a t-att-href="'/kits/add_to_cart?product_sku=' + configured_product.default_code|urlencode" class="btn btn-secondary">
                        Add to Cart
                    </a> -->
                    <!-- <a t-att-href="'/shop/wishlist/add/' + str(configured_product.id)" class="btn btn-secondary fw-semibold shadow-sm d-flex align-items-center justify-content-center gap-2 px-4 py-2 text-center">
                      <i class="fa fa-heart"></i> Save for Later
                    </a> -->

                  </div>

                </t>

                <div class="terms-section mb-4">
                  <!-- Terms and Conditions (Underlined Link) -->
                  <a href="/terms" class="terms-link text-decoration-underline mb-2">
                  Terms and Conditions
                  </a>

                  <!-- 30-Day Money-Back Guarantee (Plain Text) -->
                  <div class="text-muted">
                  30-Day Money-Back Guarantee
                  </div>

                  <!-- Shipping Details (Plain Text) -->
                  <div class="text-muted">
                  Shipping: 2-3 Business Days
                  </div>
                </div>

              </t>

              <t t-if="selected_color">
                <!-- Step 1: Size Selection -->
                <!-- Header Section -->
                <div class="d-flex align-items-center mb-3 w-100">
                  <div class="rounded-circle bg-secondary text-white d-flex align-items-center justify-content-center me-2" style="width: 25px; height: 25px; font-size: 12px;">
                    <strong>1</strong>
                  </div>

                  <!-- Desktop: Collapse Trigger -->
                  <h4 class="mb-0 flex-grow-1 d-none d-md-block" data-bs-toggle="collapse" href="#sizeSelection" aria-expanded="false" aria-controls="sizeSelection">
    Select Sizes
                  </h4>
                  <button class="btn btn-link text-decoration-none d-none d-md-block" type="button" style="font-size: 18px; padding: 0; margin-left: auto;" data-bs-toggle="collapse" data-bs-target="#sizeSelection" aria-expanded="false" aria-controls="sizeSelection">
                    <span class="p-2" style="font-size: 24px; font-weight: bold;" id="sizeToggle"></span>
                  </button>

                  <!-- Mobile: Modal Trigger -->
                  <h4 class="mb-0 flex-grow-1 d-block d-md-none" data-bs-toggle="modal" data-bs-target="#sizeModal">
    Select Sizes
                  </h4>
                  <button class="btn btn-link text-decoration-none d-block d-md-none" type="button" style="font-size: 18px; padding: 0; margin-left: auto;" data-bs-toggle="modal" data-bs-target="#sizeModal">
                    <span class="p-2" style="font-size: 24px; font-weight: bold;">+ </span>
                  </button>
                </div>

                <!-- Desktop Collapse Content -->
                <div id="sizeSelection" class="collapse d-none d-md-block">
                  <div class="row">
                    <t t-foreach="size_cards" t-as="card">
                      <div class="col-6 col-md-6 col-lg-4 col-xl-3 mb-3">
                        <a t-att-href="'/kits?collection=%s%s%s%s' % (
              selected_collection, '&amp;color=' + selected_color if selected_color else '', '&amp;cabinet_sku=' + card['cabinet_sku'] if selected_sku != card['cabinet_sku'] else '', '&amp;size=' + card['size'] if selected_size != card['size'] else '')" class="text-decoration-none">
                          <div t-attf-class="card h-100 #{'border border-2 border-secondary' if card['cabinet_sku'] == selected_sku and card['size'] == selected_size else ''}">
                            <t t-if="card['image']">
                              <img t-att-src="'data:image/png;base64,%s' % card['image']" class="card-img-top p-2" style="height: 100px; object-fit: cover;" alt="Product Image"/>
                            </t>
                            <t t-else="">
                              <div class="card-img-top bg-light text-center d-flex align-items-center justify-content-center p-2" style="height: 100px;">
                                <span class="text-muted">No Image</span>
                              </div>
                            </t>
                            <div class="card-body text-center">
                              <strong>
                                <t t-esc="card['size']"/>
                              </strong>
                              <br/>
                              <div class="text-left">
                                <div class="fw-normal fs-6 fs-sm-6 fs-md-5 fs-lg-5 fs-xl-4">
                                  <t t-esc="card['name']"/>
                                </div>
                              </div>
                            </div>
                          </div>
                        </a>
                      </div>
                    </t>
                  </div>
                </div>

                <!-- Mobile Modal Content -->
                <div class="modal fade d-md-none" id="sizeModal" tabindex="-1" aria-labelledby="sizeModalLabel" aria-hidden="true">
                  <div class="modal-dialog modal-lg modal-dialog-scrollable">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h5 class="modal-title" id="sizeModalLabel">Select Sizes</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                      </div>
                      <div class="modal-body">
                        <div class="row">
                          <t t-foreach="size_cards" t-as="card">
                            <div class="col-6 mb-3">
                              <a t-att-href="'/kits?collection=%s%s%s%s' % (
                    selected_collection, '&amp;color=' + selected_color if selected_color else '', '&amp;cabinet_sku=' + card['cabinet_sku'] if selected_sku != card['cabinet_sku'] else '', '&amp;size=' + card['size'] if selected_size != card['size'] else '')" class="text-decoration-none">
                                <div t-attf-class="card h-100 #{'border border-2 border-secondary' if card['cabinet_sku'] == selected_sku and card['size'] == selected_size else ''}">
                                  <t t-if="card['image']">
                                    <img t-att-src="'data:image/png;base64,%s' % card['image']" class="card-img-top p-2" style="height: 100px; object-fit: cover;" alt="Product Image"/>
                                  </t>
                                  <t t-else="">
                                    <div class="card-img-top bg-light text-center d-flex align-items-center justify-content-center p-2" style="height: 100px;">
                                      <span class="text-muted">No Image</span>
                                    </div>
                                  </t>
                                  <div class="card-body text-center">
                                    <strong>
                                      <t t-esc="card['size']"/>
                                    </strong>
                                    <br/>
                                    <div class="text-left">
                                      <div class="fw-normal fs-6">
                                        <t t-esc="card['name']"/>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </a>
                            </div>
                          </t>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

              </t>

              <hr/>

              <!-- Step 2: Countertop -->


              <t t-if="selected_sku and selected_size">

                <!-- Section Header -->
                <div class="d-flex align-items-center mb-3 w-100">
                  <div class="rounded-circle bg-secondary text-white d-flex align-items-center justify-content-center me-2" style="width: 25px; height: 25px; font-size: 12px;">
                    <strong>2</strong>
                  </div>

                  <!-- Desktop View (md and up) -->
                  <div class="d-none d-md-flex align-items-center flex-grow-1">
                    <h4 class="mb-0 flex-grow-1" data-bs-toggle="collapse" href="#countertopSelection" aria-expanded="false" aria-controls="countertopSelection">
      Add Countertop
                    </h4>
                    <button class="btn btn-link text-decoration-none" type="button" data-bs-toggle="collapse" data-bs-target="#countertopSelection" aria-expanded="false" aria-controls="countertopSelection" style="font-size: 18px; padding: 0; margin-left: auto;">
                      <span class="p-2" style="font-size: 24px; font-weight: bold;">+</span>
                    </button>
                  </div>

                  <!-- Mobile View (sm and below) -->
                  <div class="d-flex d-md-none align-items-center flex-grow-1">
                    <h4 class="mb-0 flex-grow-1" data-bs-toggle="modal" data-bs-target="#countertopModal">
      Add Countertop
                    </h4>
                    <button class="btn btn-link text-decoration-none" type="button" data-bs-toggle="modal" data-bs-target="#countertopModal" style="font-size: 18px; padding: 0; margin-left: auto;">
                      <span class="p-2" style="font-size: 24px; font-weight: bold;">+</span>
                    </button>
                  </div>
                </div>

                <!-- Desktop Collapse -->
                <div id="countertopSelection" class="collapse d-none d-md-block">
                  <div class="row">
                    <t t-if="counter_top_cards">
                      <t t-foreach="counter_top_cards" t-as="card">
                        <div class="col-6 col-md-6 col-lg-4 col-xl-3 mb-3">
                          <a t-att-href="'/kits?collection=%s%s%s%s%s%s%s' % (
              selected_collection, '&amp;color=' + selected_color if selected_color else '', '&amp;cabinet_sku=' + selected_sku if selected_sku else '', '&amp;size=' + selected_size if selected_size else '', '&amp;counter_top_sku=' + card['counter_top_sku'] if selected_countertop != card['counter_top_sku'] else '', '&amp;mirror_sku=' + selected_mirror if selected_mirror else '', '&amp;faucet_sku=' + selected_faucet if selected_faucet else ''
            )" class="text-decoration-none">
                            <div t-attf-class="card h-100 #{'border border-2 border-secondary' if card['counter_top_sku'] == selected_countertop else ''}">
                              <t t-if="card['image']">
                                <img t-att-src="'data:image/png;base64,%s' % card['image']" class="card-img-top p-2" style="height: 100px; object-fit: cover;" alt="Countertop Image"/>
                              </t>
                              <t t-else="">
                                <div class="card-img-top bg-light text-center d-flex align-items-center justify-content-center p-2" style="height: 100px;">
                                  <span class="text-muted">No Image</span>
                                </div>
                              </t>
                              <div class="card-body text-left">
                                <div class="fw-normal fs-6">
                                  <t t-esc="card['name']"/>
                                </div>
                              </div>
                            </div>
                          </a>
                        </div>
                      </t>
                    </t>
                    <t t-else="">
                      <div class="col-12">
                        <div class="alert alert-info">No Countertops Available</div>
                      </div>
                    </t>
                  </div>
                </div>

                <!-- Mobile Modal -->
                <div class="modal fade d-md-none" id="countertopModal" tabindex="-1" aria-labelledby="countertopModalLabel" aria-hidden="true">
                  <div class="modal-dialog modal-lg modal-dialog-scrollable">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h5 class="modal-title" id="countertopModalLabel">Add Countertop</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                      </div>
                      <div class="modal-body">
                        <div class="row">
                          <t t-if="counter_top_cards">
                            <t t-foreach="counter_top_cards" t-as="card">
                              <div class="col-6 mb-3">
                                <a t-att-href="'/kits?collection=%s%s%s%s%s%s%s' % (
                    selected_collection, '&amp;color=' + selected_color if selected_color else '', '&amp;cabinet_sku=' + selected_sku if selected_sku else '', '&amp;size=' + selected_size if selected_size else '', '&amp;counter_top_sku=' + card['counter_top_sku'] if selected_countertop != card['counter_top_sku'] else '', '&amp;mirror_sku=' + selected_mirror if selected_mirror else '', '&amp;faucet_sku=' + selected_faucet if selected_faucet else ''
                  )" class="text-decoration-none">
                                  <div t-attf-class="card h-100 #{'border border-2 border-secondary' if card['counter_top_sku'] == selected_countertop else ''}">
                                    <t t-if="card['image']">
                                      <img t-att-src="'data:image/png;base64,%s' % card['image']" class="card-img-top p-2" style="height: 100px; object-fit: cover;" alt="Countertop Image"/>
                                    </t>
                                    <t t-else="">
                                      <div class="card-img-top bg-light text-center d-flex align-items-center justify-content-center p-2" style="height: 100px;">
                                        <span class="text-muted">No Image</span>
                                      </div>
                                    </t>
                                    <div class="card-body text-left">
                                      <div class="fw-normal fs-6">
                                        <t t-esc="card['name']"/>
                                      </div>
                                    </div>
                                  </div>
                                </a>
                              </div>
                            </t>
                          </t>
                          <t t-else="">
                            <div class="col-12">
                              <div class="alert alert-info">No Countertops Available</div>
                            </div>
                          </t>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <hr/>

              </t>












              <!-- Step 3: Mirror -->
              <t t-if="selected_sku and selected_size">
                <!-- Header Section -->
                <div class="d-flex align-items-center mb-3 w-100">
                  <div class="rounded-circle bg-secondary text-white d-flex align-items-center justify-content-center me-2" style="width: 25px; height: 25px; font-size: 12px;">
                    <strong>3</strong>
                  </div>

                  <!-- Desktop (Collapse) -->
                  <div class="d-none d-md-flex align-items-center flex-grow-1">
                    <h4 class="mb-0 flex-grow-1" data-bs-toggle="collapse" href="#mirrorSelection" aria-expanded="false" aria-controls="mirrorSelection">
        Add Mirror
                    </h4>
                    <button class="btn btn-link text-decoration-none" type="button" style="font-size: 18px; padding: 0; margin-left: auto;" data-bs-toggle="collapse" data-bs-target="#mirrorSelection" aria-expanded="false" aria-controls="mirrorSelection">
                      <span class="p-2" style="font-size: 24px; font-weight: bold;">&#x25BC;</span>
                    </button>
                  </div>

                  <!-- Mobile (Modal) -->
                  <div class="d-flex d-md-none align-items-center flex-grow-1">
                    <h4 class="mb-0 flex-grow-1" data-bs-toggle="modal" data-bs-target="#mirrorModal">
        Add Mirror
                    </h4>
                    <button class="btn btn-link text-decoration-none" type="button" style="font-size: 18px; padding: 0; margin-left: auto;" data-bs-toggle="modal" data-bs-target="#mirrorModal">
                      <span class="p-2" style="font-size: 24px; font-weight: bold;">&#x25BC;</span>
                    </button>
                  </div>
                </div>

                <!-- Desktop Collapse -->
                <div id="mirrorSelection" t-att-class="not selected_mirror and 'collapse' or ''" class="d-none d-md-block">
                  <div class="row">
                    <t t-if="mirror_cards">
                      <t t-foreach="mirror_cards" t-as="card">
                        <div class="col-6 col-md-6 col-lg-4 col-xl-3 mb-3">
                          <a t-att-href="'/kits?collection=%s%s%s%s%s%s%s' % (
              selected_collection, '&amp;color=' + selected_color if selected_color else '', '&amp;cabinet_sku=' + selected_sku if selected_sku else '', '&amp;size=' + selected_size if selected_size else '', '&amp;counter_top_sku=' + selected_countertop if selected_countertop else '', '&amp;mirror_sku=' + card['mirror_sku'] if selected_mirror != card['mirror_sku'] else '', '&amp;faucet_sku=' + selected_faucet if selected_faucet else ''
            )" class="text-decoration-none">
                            <div t-attf-class="card h-100 #{'border border-2 border-secondary' if card['mirror_sku'] == selected_mirror else ''}">
                              <t t-if="card['image']">
                                <img t-att-src="'data:image/png;base64,%s' % card['image']" class="card-img-top p-2" style="height: 100px; object-fit: cover;" alt="Mirror Image"/>
                              </t>
                              <t t-else="">
                                <div class="card-img-top bg-light text-center d-flex align-items-center justify-content-center p-2" style="height: 100px;">
                                  <span class="text-muted">No Image</span>
                                </div>
                              </t>
                              <div class="card-body text-left">
                                <div class="fw-normal fs-6 fs-sm-6 fs-md-5 fs-lg-5 fs-xl-4">
                                  <t t-esc="card['name']"/>
                                </div>
                              </div>
                            </div>
                          </a>
                        </div>
                      </t>
                    </t>
                    <t t-else="">
                      <div class="col-3 mb-3">
                        <div class="card h-100">
                          <div class="card-body text-center">
                            <span class="text-muted">No Mirrors</span>
                          </div>
                        </div>
                      </div>
                    </t>
                  </div>
                </div>

                <!-- Mobile Modal -->
                <div class="modal fade d-md-none" id="mirrorModal" tabindex="-1" aria-labelledby="mirrorModalLabel" aria-hidden="true">
                  <div class="modal-dialog modal-lg modal-dialog-scrollable">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h5 class="modal-title" id="mirrorModalLabel">Add Mirror</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                      </div>
                      <div class="modal-body">
                        <div class="row">
                          <t t-if="mirror_cards">
                            <t t-foreach="mirror_cards" t-as="card">
                              <div class="col-6 mb-3">
                                <a t-att-href="'/kits?collection=%s%s%s%s%s%s%s' % (
                    selected_collection, '&amp;color=' + selected_color if selected_color else '', '&amp;cabinet_sku=' + selected_sku if selected_sku else '', '&amp;size=' + selected_size if selected_size else '', '&amp;counter_top_sku=' + selected_countertop if selected_countertop else '', '&amp;mirror_sku=' + card['mirror_sku'] if selected_mirror != card['mirror_sku'] else '', '&amp;faucet_sku=' + selected_faucet if selected_faucet else ''
                  )" class="text-decoration-none">
                                  <div t-attf-class="card h-100 #{'border border-2 border-secondary' if card['mirror_sku'] == selected_mirror else ''}">
                                    <t t-if="card['image']">
                                      <img t-att-src="'data:image/png;base64,%s' % card['image']" class="card-img-top p-2" style="height: 100px; object-fit: cover;" alt="Mirror Image"/>
                                    </t>
                                    <t t-else="">
                                      <div class="card-img-top bg-light text-center d-flex align-items-center justify-content-center p-2" style="height: 100px;">
                                        <span class="text-muted">No Image</span>
                                      </div>
                                    </t>
                                    <div class="card-body text-left">
                                      <div class="fw-normal fs-6">
                                        <t t-esc="card['name']"/>
                                      </div>
                                    </div>
                                  </div>
                                </a>
                              </div>
                            </t>
                          </t>
                          <t t-else="">
                            <div class="col-12 mb-3">
                              <div class="card h-100">
                                <div class="card-body text-center">
                                  <span class="text-muted">No Mirrors</span>
                                </div>
                              </div>
                            </div>
                          </t>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <hr/>
              </t>



              <!-- Step 4: Faucet -->
              <t t-if="selected_sku and selected_size">

                <div class="d-flex align-items-center mb-3 w-100">
                  <div class="rounded-circle bg-secondary text-white d-flex align-items-center justify-content-center me-2" style="width: 25px; height: 25px; font-size: 12px;">
                    <strong>4</strong>
                  </div>
                  <h4 class="mb-0 flex-grow-1" data-bs-toggle="collapse" href="#faucetSelection" aria-expanded="false" aria-controls="faucetSelection">
                    Add Faucet
                  </h4>
                  <button class="btn btn-link text-decoration-none" type="button" style="font-size: 18px; padding: 0; margin-left: auto;" data-bs-toggle="collapse" data-bs-target="#faucetSelection" aria-expanded="false" aria-controls="faucetSelection">
                    <span class="p-2" style="font-size: 24px; font-weight: bold;" id="faucetToggle"></span>
                  </button>
                </div>

                <div id="faucetSelection" t-att-class="not selected_faucet and 'collapse' or ''">
                  <div class="row">
                    <t t-if="faucet_cards">
                      <t t-foreach="faucet_cards" t-as="card">
                        <div class="col-6 col-md-6 col-lg-4 col-xl-3 mb-3">
                          <a t-att-href="'/kits?collection=%s%s%s%s%s%s%s' % (
                                  selected_collection, '&amp;color=' + selected_color if selected_color else '', '&amp;cabinet_sku=' + selected_sku if selected_sku else '', '&amp;size=' + selected_size if selected_size else '', '&amp;counter_top_sku=' + selected_countertop if selected_countertop else '', '&amp;mirror_sku=' + selected_mirror if selected_mirror else '', '&amp;faucet_sku=' + card['faucet_sku'] if selected_faucet != card['faucet_sku'] else ''
                                )" class="text-decoration-none">
                            <div t-attf-class="card h-100 #{'border border-2 border-secondary' if card['faucet_sku'] == selected_faucet else ''}">
                              <t t-if="card['image']">
                                <img t-att-src="'data:image/png;base64,%s' % card['image']" class="card-img-top p-2" style="height: 100px; object-fit: cover;" alt="Faucet Image"/>
                              </t>
                              <t t-else="">
                                <div class="card-img-top bg-light text-center d-flex align-items-center justify-content-center p-2" style="height: 100px;">
                                  <span class="text-muted">No Image</span>
                                </div>
                              </t>
                              <div class="card-body text-left">
                                <div class="fw-normal fs-6 fs-sm-6 fs-md-5 fs-lg-5 fs-xl-4">
                                  <t t-esc="card['name']"/>
                                </div>
                              </div>
                            </div>
                          </a>
                        </div>
                      </t>
                    </t>
                    <t t-else="">
                      <!-- If No Faucets: Show this fallback card -->
                      <div class="col-3 mb-3">
                        <div class="card h-100">
                          <div class="card-body text-center">
                            <span class="text-muted">No Faucets</span>
                          </div>
                        </div>
                      </div>
                    </t>

                  </div>
                </div>
              </t>

            </div>
          </div>


        </t>



      </div>
    </t>

    <script type="text/javascript">

    document.addEventListener("DOMContentLoaded", function () {
        const buyNowBtn = document.getElementById("buy_now_button");
        const form = buyNowBtn.closest("form");

        buyNowBtn.addEventListener("click", function () {
            const formData = new FormData(form);

            fetch("/shop/cart/update", {
                method: "POST",
                body: formData,
                credentials: "same-origin"
            })
            .then(response => {
                if (response.ok) {
                    window.location.href = "/shop/shipping-details";
                } else {
                    alert("Failed to add product to cart.");
                }
            })
            .catch(err => {
                console.error(err);
                alert("An error occurred.");
            });
        });
    });

    // Function to handle dynamic collapse behavior
    function handleCollapseToggle(collapseId, toggleId) {
        var collapseElement = document.getElementById(collapseId);
        var toggleElement = document.getElementById(toggleId);

        // Event listener for showing the collapse
        collapseElement.addEventListener('show.bs.collapse', function () {
            toggleElement.innerHTML = '-';
            var button = document.querySelector(`[data-bs-target="#${collapseId}"]`);
            button.setAttribute('aria-expanded', 'true');
        });

        // Event listener for hiding the collapse
        collapseElement.addEventListener('hide.bs.collapse', function () {
            toggleElement.innerHTML = '+';
            var button = document.querySelector(`[data-bs-target="#${collapseId}"]`);
            button.setAttribute('aria-expanded', 'false');
        });

        // Set the initial icon based on whether the collapse section is already visible
        if (collapseElement.classList.contains('show')) {
            toggleElement.innerHTML = '-'; // If visible, set the icon to '-'
        } else {
            toggleElement.innerHTML = '+'; // If hidden, set the icon to '+'
        }

        // Handle immediate toggle: Close the section if it's open
        var button = document.querySelector(`[data-bs-target="#${collapseId}"]`);
        button.addEventListener('click', function () {
            // If the section is currently open, close it
            if (collapseElement.classList.contains('show')) {
                $(collapseElement).collapse('hide'); // Use Bootstrap's collapse API to hide it
            } else {
                $(collapseElement).collapse('show'); // Use Bootstrap's collapse API to show it
            }
        });
    }

    // Initialize collapses for each section
    handleCollapseToggle('sizeSelection', 'sizeToggle');
    handleCollapseToggle('countertopSelection', 'countertopToggle');
    handleCollapseToggle('mirrorSelection', 'mirrorToggle');
    handleCollapseToggle('faucetSelection', 'faucetToggle');



  // Function to open the modal
   function openModal() {
    var modal = document.getElementById('imageModal');
    
    // Make the modal visible
    modal.style.display = 'block';
    
    // Create the backdrop manually if it doesn't exist
    var modalBackdrop = document.querySelector('.modal-backdrop');
    if (!modalBackdrop) {
      var backdrop = document.createElement('div');
      backdrop.classList.add('modal-backdrop', 'fade', 'show');
      document.body.appendChild(backdrop);
      
      // Close modal when backdrop is clicked
      backdrop.addEventListener('click', closeModal);
    }
  }

  // Function to close the modal
  function closeModal() {
    var modal = document.getElementById('imageModal');
    var modalBackdrop = document.querySelector('.modal-backdrop');
    
    // Hide the modal and remove the backdrop
    modal.style.display = 'none';
    if (modalBackdrop) {
      modalBackdrop.remove();
    }
  }

    </script>

    <style>
          /* Optional: Extra styling for modal image */
        .modal-body img {
          width: 100%;
          max-width: 800px; /* Set max width to ensure large images don't overflow */
          height: auto;
          object-fit: contain;
        }

        .img-thumbnail {
          cursor: zoom-in; /* Shows pointer on hover for the image */
        }



        .out-of-stock-wrapper {
          position: relative;
        }

        .out-of-stock-overlay {
          background-color: rgba(0, 0, 0, 0.7); /* Darker gray with lower opacity */
          color: white;
          font-size: 24px;
          padding: 20px;
          border-radius: 8px;
          transition: opacity 0.3s ease;
          z-index: 10; /* Ensure the overlay appears above the image */
          pointer-events: auto; /* Allow hover effect */
        }

        .out-of-stock-overlay:hover {
          opacity: 0; /* Hide when hovered */
        }

        /* Optional: Text positioning */
        .overlay-text {
          text-align: center;
          font-size: 30px;
          font-weight: thin;
        }

        /* Flexbox to center the text */
        .out-of-stock-overlay {
          display: flex;
          justify-content: center;
          align-items: center;
        }


        /* Optional, if spacing or alignment needs tweaking */
        .product-action-container {
            width: 100%;
        }
    </style>

  </template>
</odoo>
