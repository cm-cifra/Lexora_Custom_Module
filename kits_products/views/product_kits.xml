<odoo>
    <template id="kit_group_detail_template" name="Kit Group Detail">
        <t t-call="website.layout">
            <div class="container py-5">

                <div class="row g-5">
                    <div class="col-lg-6">
                        <div class="card  border-0 h-100">
                            <div class="card-body">

                                <t t-if="kit and product">
                                    <nav aria-label="breadcrumb" class="mb-3">
                                        <ol class="breadcrumb small">
                                            <li class="breadcrumb-item">
                                                <a t-att-href="'/product_kits'" class="text-decoration-none">All Products</a>
                                            </li>
                                            <li class="breadcrumb-item active" aria-current="page">
                                                <t t-esc="product.name" />
                                            </li>
                                        </ol>
                                    </nav>



                                    <div class="text-center mb-4 border-b">
                                        <img t-att-src="'/web/image/product.product/' + str(product.id) + '/image_1920'" alt="Product Image" class="img-fluid rounded  " style="height: 400px; object-fit: cover;" />
                                    </div>


                                    <h3 class="fw-semibold mb-2 text-start">
                                        <t t-esc="product.name" />
                                    </h3>
                                    <p class="text-muted small text-center mb-3">
                                        <t t-set="title" t-value="product.name or 'Kit Details'" />
                                        <t t-set="description" t-value="product.description_sale or 'Explore our premium kits.'" />

                                    </p>
                                    <t t-if="kit_price">
                                        <div class="product_price mt-2 mb-3 d-inline-block">
                                            <h3 class="css_editable_mode_hidden">
                                                <span class="oe_price" style="white-space: nowrap;">
                                                    <t t-esc="kit_price"/>
                                                </span>
                                            </h3>
                                        </div>
                                    </t>
                                    <t t-else="">
                                        <div class="product_price mt-2 mb-3 text-muted">
                                            <h3>Price not available</h3>
                                        </div>
                                    </t>
                                    <t t-if="kit.product_id">
                                        <t t-if="product.qty_available > 0">
                                            <form action="/shop/cart/update" method="post" class="mt-4">
                                                <input type="hidden" name="product_id" t-att-value="kit.product_id.id" />
                                                <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()" />

                                                <div class="d-flex flex-wrap align-items-center gap-3">



                                                    <div class="input-group" style="width: 160px;">
                                                        <button type="button" class="btn btn-outline-secondary" title="Decrease Quantity" onclick="let input = this.parentNode.querySelector('input'); if (input.value > 1) input.stepDown();">âˆ’</button>
                                                        <input name="add_qty" type="number" class="form-control text-center" value="1" min="1" style="max-width: 60px;" />
                                                        <button type="button" class="btn btn-outline-secondary" title="Increase Quantity" onclick="this.parentNode.querySelector('input').stepUp()">+</button>
                                                    </div>

                                                    <button type="submit" class="btn btn-dark fw-semibold shadow-sm d-flex align-items-center gap-2 px-4 py-2">
                                                        <i class="fa fa-cart-plus"></i> Add to Cart
                                                    </button>

                                                    <button type="submit" name="buy_now" value="1" formaction="/shop/cart/update?buy_now=1" class="btn btn-outline-primary fw-semibold shadow-sm d-flex align-items-center gap-2 px-4 py-2">
                                                        <i class="fa fa-heart-o"></i> Buy Now
                                                    </button>

                                                    <a t-att-href="'/shop/wishlist/add/' + str(kit.product_id.id)" class="btn btn-light border fw-semibold shadow-sm d-flex align-items-center gap-2 px-3 py-2">
                                                        <i class="fa fa-heart"></i> Wishlist
                                                    </a>
                                                </div>


                                            </form>
                                        </t>
                                        <t t-else="">
                                            <!-- Out of Stock Section -->
                                            <div class="text-center mt-4">
                                                <h6 class="text-danger mb-3">
                                                    <i class="fa fa-times me-1"></i> Out of Stock
                                                </h6>
                                                <div class="text-start d-inline-block">
                                                    <div class="btn btn-link px-0" onclick="document.getElementById('stock_notification_form').classList.remove('d-none'); this.classList.add('d-none');">
                                                        <i class="fa fa-envelope-o me-1"></i> Get notified when back in stock
                                                    </div>
                                                    <div id="stock_notification_form" class="d-none mt-2">
                                                        <div class="input-group">
                                                            <input class="form-control" name="email" type="text" placeholder="youremail@gmail.com" />
                                                            <input name="product_id" type="hidden" t-att-value="product.id" />
                                                            <div class="btn btn-secondary" onclick="submitStockNotification()">
                                                                <i class="fa fa-paper-plane"></i>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div id="stock_notification_success_message" class="d-none mt-2 text-muted">
                                                        <i class="fa fa-bell"></i> We'll notify you once the product is back in stock.
                                                    </div>
                                                </div>
                                            </div>
                                        </t>
                                    </t>




                                    <t t-else="">
                                        <div class=" text-start mt-4">
                                            <p class="text-muted small mb-2">
                                                <a t-att-href="'/product_kits'" class="text-decoration-none text-muted">All Products</a> /
                                            
                                            </p>

                                        </div>
                                        <div class="alert alert-warning text-center mt-4">
                                            <div class="text-center py-5">
                                                <img t-att-src="'/kits_products/static/description/no-order.png'" alt="No Kit" style="width: 50px; opacity: 0.3;" />
                                                <h5 class="mt-3 text-muted">             Product not available for sale</h5>
                                            </div>

                                        </div>
                                    </t>
                                </t>

                                <t t-if="kit and not product">
                                    <div class=" text-start mt-4">
                                        <p class="text-muted small mb-2">
                                            <a t-att-href="'/product_kits'" class="text-decoration-none text-muted">All Products</a> /
                                            
                                        </p>

                                    </div>
                                    <div class="text-center py-5">

                                        <img t-att-src="'/kits_products/static/description/no-order.png'" alt="No Kit" style="width: 50px; opacity: 0.3;" />
                                        <h5 class="mt-3 text-muted">No matching product variant available</h5>
                                    </div>
                                </t>

                                <t t-if="not kit">
                                    <div class=" text-start mt-4">
                                        <p class="text-muted small mb-2">
                                            <a t-att-href="'/product_kits'" class="text-decoration-none text-muted">All Products</a> /
                                            
                                        </p>

                                    </div>
                                    <div class="text-center py-5">

                                        <img t-att-src="'/kits_products/static/description/no-order.png'" alt="No Kit" style="width: 50px; opacity: 0.3;" />
                                        <h5 class="mt-3 text-muted">No matching kit found for this selection</h5>
                                    </div>



                                </t>
                                <div class="container py-4">
                                    <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4">

                                        <div class="text-muted small">
                                            <a href="/terms" class="text-decoration-none text-muted fw-semibold mb-1 d-inline-block">
                                                <u>Terms and Conditions</u>
                                            </a>
                                            <div>30-day money-back guarantee</div>
                                            <div>Shipping: 2-3 Business Days</div>
                                        </div>


                                        <div class=" flex-d flex mt-3 mt-md-0 text-md-end">
                                            <span class="fw-semibold me-2">Share:</span>
                                            <div data-snippet="s_share" class="s_share text-start o_no_link_popover text-lg-end">
                                                <a href="https://www.facebook.com/sharer/sharer.php?u={url}" target="_blank" aria-label="Facebook" class="s_share_facebook mx-1 my-0">
                                                    <i data-oe-model="ir.ui.view" data-oe-id="2943" data-oe-field="arch" data-oe-xpath="/t[1]/div[1]/a[1]/i[1]" class="fa fa-facebook "></i>
                                                </a>
                                                <a href="https://twitter.com/intent/tweet?text={title}&amp;url={url}" target="_blank" aria-label="Twitter" class="s_share_twitter mx-1 my-0">
                                                    <i data-oe-model="ir.ui.view" data-oe-id="2943" data-oe-field="arch" data-oe-xpath="/t[1]/div[1]/a[2]/i[1]" class="fa fa-twitter "></i>
                                                </a>
                                                <a href="https://pinterest.com/pin/create/button/?url={url}&amp;media={media}&amp;description={title}" target="_blank" aria-label="Pinterest" class="s_share_pinterest mx-1 my-0">
                                                    <i data-oe-model="ir.ui.view" data-oe-id="2943" data-oe-field="arch" data-oe-xpath="/t[1]/div[1]/a[5]/i[1]" class="fa fa-pinterest "></i>
                                                </a>
                                                <a href="mailto:?body={url}&amp;subject={title}" aria-label="Email" class="s_share_email mx-1 my-0">
                                                    <i data-oe-model="ir.ui.view" data-oe-id="2943" data-oe-field="arch" data-oe-xpath="/t[1]/div[1]/a[6]/i[1]" class="fa fa-envelope "></i>
                                                </a>
                                            </div>
                                        </div>
                                    </div>

                                    <t t-if="product and product.product_tmpl_id and product.product_tmpl_id.valid_product_template_attribute_line_ids">
                                        <div class="border-top pt-4 mt-4">
                                            <h4 class="fw-bold mb-3 text-dark">Specifications</h4>
                                            <div class="table-responsive">
                                                <table class="table table-bordered table-hover shadow-sm rounded-3 overflow-hidden">
                                                    <tbody>
                                                        <t t-foreach="product.product_tmpl_id.valid_product_template_attribute_line_ids" t-as="ptal">
                                                            <tr t-if="ptal.value_ids">
                                                                <td class="fw-semibold bg-light text-nowrap text-dark w-30">

                                                                    <span class="badge bg-secondary-subtle text-dark fw-normal me-1">
                                                                        <t t-esc="ptal.attribute_id.name" />
                                                                    </span>
                                                                </td>
                                                                <td class="w-75">
                                                                    <t t-foreach="ptal.product_template_value_ids._only_active()" t-as="ptv" t-separator=", ">
                                                                        <span class="badge bg-secondary-subtle text-dark fw-normal me-1">
                                                                            <t t-esc="ptv.name" />
                                                                        </span>
                                                                    </t>
                                                                </td>
                                                            </tr>
                                                        </t>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </t>

                                    <t t-if="tags">
                                        <div class="border-top pt-4 mt-4">
                                            <h5 class="fw-bold text-dark mb-3">Tags</h5>
                                            <div class="d-flex flex-wrap gap-2">
                                                <t t-foreach="tags" t-as="tag">
                                                    <span class="badge bg-light border rounded-pill px-3 py-2 small text-muted" style="transition: all 0.2s ease;" onmouseover="this.classList.add('bg-secondary-subtle')" onmouseout="this.classList.remove('bg-secondary-subtle')">
                                                        <t t-esc="tag.name" />
                                                    </span>
                                                </t>
                                            </div>
                                        </div>
                                    </t>
                                </div>


                            </div>


                        </div>
                    </div>


                    <div class="col-lg-6">
                        <t t-if="related_kits">
                            <t t-set="shown_sizes" t-value="[]" />
                            <div class="mb-5">
                                <h5 class="fw-semibold mb-4 d-flex align-items-center gap-3 text-primary">
                                    <span class="badge bg-primary text-white rounded-circle shadow d-flex align-items-center justify-content-center" style="width: 36px; height: 36px; font-size: 0.95rem;">1</span>
                                    <span style="font-size: 1.1rem;">Choose Cabinet Size</span>
                                </h5>

                                <div class="row row-cols-2 row-cols-sm-3 row-cols-md-4 row-cols-lg-5 g-3">
                                    <t t-foreach="related_kits" t-as="rel_kit">
                                        <t t-if="rel_kit.size not in shown_sizes">
                                            <t t-set="shown_sizes" t-value="shown_sizes + [rel_kit.size]" />
                                            <div class="col">
                                                <a t-att-href="'/product_kits/group?collection=%s&amp;size=%s' % (rel_kit.collection or '', rel_kit.size or '')" class="text-decoration-none">
                                                    <div class="card text-center p-2 h-100 rounded-3 border-2 transition border-light shadow">
                                                        <div class="d-flex justify-content-center align-items-center bg-light rounded" style="height: 72px;">
                                                            <img t-att-src="'/web/image/product.product/' + str(rel_kit.product_id.id) + '/image_1920'" class="img-fluid" style="max-height: 64px; object-fit: contain;" />
                                                        </div>
                                                        <div class="mt-2">
                                                            <small class="text-dark fw-semibold" style="font-size: 11px;">
                                                                <t t-esc="rel_kit.size" />
                                                            </small>
                                                        </div>
                                                    </div>
                                                </a>
                                            </div>
                                        </t>
                                    </t>
                                </div>
                            </div>
                        </t>

                        <t t-foreach="['cabinet', 'counter_top', 'mirror', 'faucet']" t-as="category">
                            <t t-if="components[category]">
                                <div class="mb-5">
                                    <div class="d-flex align-items-center gap-2 mb-3 border-bottom pb-2">
                                        <span class="badge bg-primary text-white rounded-circle d-flex align-items-center justify-content-center" style="width: 28px; height: 28px; font-size: 0.85rem;">
                                            <t t-esc="{'cabinet': 2, 'counter_top': 3, 'mirror': 4, 'faucet': 5}[category]" />
                                        </span>
                                        <h6 class="mb-0 fw-semibold text-uppercase text-dark" style="font-size: 0.95rem;">
                                            <t t-esc="{'cabinet': 'Color', 'counter_top': 'Counter Top', 'mirror': 'Mirror', 'faucet': 'Faucet'}[category]" />
                                        </h6>
                                    </div>
                                    <div class="row g-3">
                                        <t t-foreach="components[category]" t-as="comp">
                                            <div class="col-6 col-sm-4 col-lg-3">
                                                <a t-att-href="'/product_kits/group?collection=%s&amp;size=%s&amp;cabinet=%s&amp;counter_top=%s&amp;mirror=%s&amp;faucet=%s' % (
                collection,
                size or '',
                ('' if (category == 'cabinet' and cabinet == comp.id) else (comp.id if category == 'cabinet' else cabinet or '')),
                ('' if (category == 'counter_top' and counter_top == comp.id) else (comp.id if category == 'counter_top' else counter_top or '')),
                ('' if (category == 'mirror' and mirror == comp.id) else (comp.id if category == 'mirror' else mirror or '')),
                ('' if (category == 'faucet' and faucet == comp.id) else (comp.id if category == 'faucet' else faucet or ''))
            )" class="text-decoration-none">
                                                    <div t-attf-class="card text-center p-2 h-100 rounded-3 border-2 transition #{'border-primary shadow-sm' if (
                        (category == 'cabinet' and comp.id == cabinet) or
                        (category == 'counter_top' and comp.id == counter_top) or
                        (category == 'mirror' and comp.id == mirror) or
                        (category == 'faucet' and comp.id == faucet)
                    ) else 'border-light shadow'}" style="min-height: 140px;">

                                                        <div class="d-flex justify-content-center align-items-center bg-light rounded" style="height: 72px;">
    <t t-set="image_url" t-value="
        (custom_image_kit and getattr(custom_image_kit, category + '_image', False)) 
        and ('/web/image/product.kits/%s/%s_image' % (custom_image_kit.id, category)) 
        or ('/web/image/product.product/%s/image_1920' % comp.id)
    "/>
    <img t-att-src="image_url" class="img-fluid" style="max-height: 64px; object-fit: contain;" />
</div>

                                                        <div class="mt-2 text-center">
                                                            <small class="text-muted d-block" style="font-size: 11px;">
                                                                <t t-esc="comp.default_code or 'No SKU'" />
                                                            </small>
                                                            <small class="text-dark fw-semibold" style="font-size: 11px;">
                                                                <t t-set="kit_color" t-value="''" />
                                                                <t t-foreach="kits" t-as="kit">
                                                                    <t t-if="not kit_color and comp.id in kit.cabinet_ids.ids">
                                                                        <t t-set="kit_color" t-value="kit.color or ''" />
                                                                    </t>
                                                                </t>
                                                                <t t-esc="kit_color" />
                                                            </small>
                                                        </div>
                                                    </div>
                                                </a>
                                            </div>
                                        </t>
                                    </div>


                                </div>
                            </t>
                        </t>
                    </div>


                </div>
                <div class="mt-4 text-end">
                    <a t-att-href="'/product_kits/group?collection=%s&amp;size=%s' % (collection, size or '')" class="btn btn-outline-secondary">Reset Selection</a>
                </div>

            </div>



        </t>
        <script type="text/javascript">
           
function validateEmail(email) {
    const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return re.test(email);
}

function submitStockNotification() {
    const email = document.getElementById('stock_notification_input').value;
    const productId = document.querySelector('input[name="product_id"]').value;

    if (!validateEmail(email)) {
        document.getElementById('stock_notification_input_incorrect').classList.remove('d-none');
        return;
    }

    // Hide error and show success (you should connect to backend via AJAX here)
    document.getElementById('stock_notification_input_incorrect').classList.add('d-none');
    document.getElementById('stock_notification_form').classList.add('d-none');
    document.getElementById('stock_notification_success_message').classList.remove('d-none');

    // Optional: Send to your controller with fetch/AJAX
    /*
    fetch('/notify_me_stock', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({email: email, product_id: productId})
    });
    */
}
 

        </script>
    </template>



</odoo>
